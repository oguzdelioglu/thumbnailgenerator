<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thumbnail Studio v1.0.0 (Director's Edition)</title>
    <meta name="description"
        content="YouTube thumbnail prompt generator for AI image creation. Create stunning clickbait thumbnails with ease.">
    <meta name="keywords" content="youtube, thumbnail, ai, prompt, generator, midjourney, dalle, stable diffusion">
    <meta name="author" content="Thumbnail Studio">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://thumbnailstudio.app/">
    <meta property="og:title" content="Thumbnail Studio - AI Thumbnail Prompt Generator">
    <meta property="og:description" content="Create stunning YouTube thumbnails with AI-powered prompt generation.">
    <meta property="og:image" content="https://thumbnailstudio.app/og-image.jpg">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://thumbnailstudio.app/">
    <meta property="twitter:title" content="Thumbnail Studio - AI Thumbnail Prompt Generator">
    <meta property="twitter:description"
        content="Create stunning YouTube thumbnails with AI-powered prompt generation.">
    <meta property="twitter:image" content="https://thumbnailstudio.app/og-image.jpg">

    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#8b5cf6">
    <link rel="apple-touch-icon" href="icon-192.png">

    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Thumbnail Studio",
        "description": "AI-powered YouTube thumbnail prompt generator",
        "url": "https://thumbnailstudio.app/",
        "applicationCategory": "DesignApplication",
        "operatingSystem": "Any"
    }
    </script>

    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@500&display=swap"
        rel="stylesheet">
    <style>
        :root {
            /* Color Palette - Cyberpunk/Pro Studio */
            --bg-main: #050505;
            --bg-gradient: radial-gradient(circle at 50% -20%, #2e1065, #000000 70%);

            --glass-panel: rgba(20, 20, 30, 0.75);
            --glass-border: rgba(255, 255, 255, 0.08);
            --glass-highlight: rgba(255, 255, 255, 0.05);

            --primary: #8b5cf6;
            /* Violet */
            --primary-glow: 0 0 25px rgba(139, 92, 246, 0.5);
            --accent: #38bdf8;
            /* Sky Blue */
            --secondary: #f472b6;
            /* Pink */
            --danger: #ef4444;
            /* Red */

            --text-bright: #ffffff;
            --text-muted: #94a3b8;

            --input-bg: rgba(0, 0, 0, 0.6);
            --chip-bg: rgba(255, 255, 255, 0.05);

            --hud-bg: rgba(10, 10, 15, 0.95);
            --hud-border: #eab308;
            /* Amber */
        }

        body {
            font-family: 'Inter', system-ui, sans-serif;
            background: var(--bg-main);
            background-image: var(--bg-gradient);
            color: var(--text-bright);
            margin: 0;
            padding: 30px 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            box-sizing: border-box;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            background: var(--glass-panel);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 50px 100px -20px rgba(0, 0, 0, 0.9);
        }

        /* --- HEADER --- */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--glass-border);
            flex-wrap: wrap;
            gap: 20px;
        }

        h1 {
            margin: 0;
            font-size: 1.8rem;
            font-weight: 800;
            letter-spacing: -0.5px;
            background: linear-gradient(135deg, #fff 30%, var(--primary));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        /* G√úNCELLENEN BADGE STƒ∞Lƒ∞ */
        .v8-badge {
            background: #eab308;
            /* Amber/Gold solid background */
            color: #000;
            /* Black text for max contrast */
            font-size: 0.75rem;
            padding: 4px 12px;
            border-radius: 4px;
            vertical-align: middle;
            box-shadow: 0 0 15px rgba(234, 179, 8, 0.6);
            -webkit-text-fill-color: #000;
            /* Override h1 gradient */
            font-weight: 800;
            letter-spacing: 0.5px;
            border: 1px solid #fff;
        }

        /* Aspect Ratio Switch */
        .ar-switch {
            display: flex;
            gap: 5px;
            background: var(--input-bg);
            padding: 4px;
            border-radius: 20px;
            border: 1px solid var(--glass-border);
        }

        .ar-btn {
            padding: 8px 16px;
            border-radius: 16px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            color: var(--text-muted);
            transition: 0.3s;
        }

        .ar-btn.active {
            background: var(--text-bright);
            color: #000;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        /* Character Position Switch */
        .pos-switch {
            display: flex;
            gap: 5px;
            background: var(--input-bg);
            padding: 4px;
            border-radius: 20px;
            border: 1px solid var(--glass-border);
        }

        .pos-btn {
            padding: 8px 14px;
            border-radius: 16px;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            color: var(--text-muted);
            transition: 0.3s;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .pos-btn:hover {
            color: var(--text-bright);
        }

        .pos-btn.active {
            background: var(--primary);
            color: #fff;
            box-shadow: var(--primary-glow);
        }

        .header-controls {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            background: var(--glass-highlight);
            border: 1px solid var(--glass-border);
            color: var(--text-bright);
            padding: 10px 20px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            transition: 0.3s all ease;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .action-btn:hover {
            background: var(--glass-border);
            border-color: var(--text-muted);
        }

        .btn-reset:hover {
            background: rgba(239, 68, 68, 0.2);
            border-color: var(--danger);
            color: #fca5a5;
        }

        /* --- MODE SWITCH --- */
        .mode-wrapper {
            background: var(--input-bg);
            padding: 6px;
            border-radius: 16px;
            display: flex;
            margin-bottom: 15px;
            border: 1px solid var(--glass-border);
        }

        .mode-btn {
            flex: 1;
            text-align: center;
            padding: 14px;
            cursor: pointer;
            border-radius: 12px;
            color: var(--text-muted);
            font-weight: 600;
            transition: 0.3s all cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .mode-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: var(--primary-glow);
        }

        .mode-btn i {
            font-size: 1.2rem;
        }

        #mode-desc {
            text-align: center;
            color: var(--accent);
            font-size: 0.9rem;
            margin-bottom: 35px;
            font-weight: 500;
        }

        /* --- MAIN GRID --- */
        .grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
        }

        @media (max-width: 900px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }

        .section {
            background: rgba(15, 23, 42, 0.4);
            border: 1px solid var(--glass-border);
            padding: 20px;
            border-radius: 18px;
            transition: 0.3s;
            display: flex;
            flex-direction: column;
        }

        .section:hover {
            border-color: rgba(139, 92, 246, 0.3);
            background: rgba(15, 23, 42, 0.6);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .section-title {
            color: var(--secondary);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .count-badge {
            background: var(--chip-bg);
            padding: 2px 8px;
            border-radius: 10px;
            color: var(--text-muted);
            font-size: 0.75rem;
        }

        /* INPUTS WITH ICONS */
        .input-group {
            position: relative;
            margin-bottom: 15px;
        }

        .input-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2rem;
            opacity: 0.7;
        }

        input[type="text"] {
            width: 100%;
            background: var(--input-bg);
            border: 1px solid var(--glass-border);
            padding: 14px 14px 14px 45px;
            /* Padding for icon */
            color: white;
            border-radius: 12px;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            transition: 0.3s all;
        }

        input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 15px rgba(56, 189, 248, 0.2);
            background: rgba(0, 0, 0, 0.8);
        }

        /* --- CHIPS --- */
        .chips-container {
            height: 140px;
            overflow-y: auto;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding-right: 5px;
            align-content: flex-start;
        }

        .chips-container::-webkit-scrollbar {
            width: 6px;
        }

        .chips-container::-webkit-scrollbar-track {
            background: transparent;
        }

        .chips-container::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 10px;
            border: 2px solid #0f172a;
        }

        .chip {
            background: var(--chip-bg);
            border: 1px solid transparent;
            color: #cbd5e1;
            padding: 8px 14px;
            border-radius: 30px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            user-select: none;
            transition: 0.2s all ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chip-icon {
            font-size: 1.1rem;
        }

        .chip:hover {
            background: var(--glass-highlight);
            color: white;
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .chip:active {
            transform: scale(0.95);
            background: var(--accent);
            color: black;
            border-color: var(--accent);
        }

        /* --- HUD SUMMARY --- */
        .hud-panel {
            background: var(--hud-bg);
            border: 1px solid var(--glass-border);
            border-top: 3px solid var(--hud-border);
            border-radius: 16px;
            padding: 25px;
            margin: 35px 0;
            position: relative;
            overflow: hidden;
        }

        .hud-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--hud-border), transparent);
            opacity: 0.5;
        }

        .hud-title {
            font-family: 'JetBrains Mono', monospace;
            color: var(--hud-border);
            font-size: 0.9rem;
            letter-spacing: 1px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .hud-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .hud-item {
            display: flex;
            flex-direction: column;
        }

        .hud-label {
            color: var(--text-muted);
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .hud-value {
            font-family: 'JetBrains Mono', monospace;
            color: white;
            font-weight: 600;
            font-size: 0.85rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            padding-left: 10px;
            border-left: 2px solid var(--accent);
        }

        /* --- GENERATE BUTTON --- */
        .btn-gen {
            width: 100%;
            padding: 22px;
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 1.3rem;
            font-weight: 800;
            letter-spacing: 1px;
            cursor: pointer;
            box-shadow: 0 10px 40px rgba(139, 92, 246, 0.4);
            transition: 0.3s all;
            position: relative;
            overflow: hidden;
        }

        .btn-gen:hover {
            transform: translateY(-3px);
            filter: brightness(1.1);
            box-shadow: 0 15px 50px rgba(139, 92, 246, 0.6);
        }

        /* --- OUTPUT --- */
        .output-container {
            margin-top: 25px;
            position: relative;
        }

        textarea {
            width: 100%;
            height: 140px;
            background: #05070a;
            color: #4ade80;
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            resize: none;
            box-sizing: border-box;
            line-height: 1.6;
        }

        textarea:focus {
            outline: none;
            border-color: #22c55e;
        }

        .copy-btn {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(51, 65, 85, 0.8);
            color: white;
            border: 1px solid var(--glass-border);
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: 0.2s;
            backdrop-filter: blur(4px);
        }

        .copy-btn:hover {
            background: var(--primary);
            border-color: var(--primary);
        }

        /* --- HISTORY SECTION (NEW) --- */
        .history-container {
            margin-top: 40px;
            border-top: 1px solid var(--glass-border);
            padding-top: 20px;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .history-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .history-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 15px;
            transition: 0.2s;
        }

        .history-item:hover {
            background: rgba(255, 255, 255, 0.06);
        }

        .hist-text {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            color: #94a3b8;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            flex: 1;
        }

        .hist-actions {
            display: flex;
            gap: 5px;
            flex-shrink: 0;
        }

        .h-btn {
            background: transparent;
            border: 1px solid var(--glass-border);
            color: var(--text-muted);
            padding: 5px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .h-btn:hover {
            background: white;
            color: black;
        }

        .h-del:hover {
            background: var(--danger);
            color: white;
            border-color: var(--danger);
        }

        /* Canvas Preview */
        .preview-container {
            margin: 35px 0;
            background: var(--hud-bg);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 25px;
            text-align: center;
        }

        .preview-title {
            font-family: 'JetBrains Mono', monospace;
            color: var(--accent);
            font-size: 0.9rem;
            letter-spacing: 1px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        #preview-canvas {
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            max-width: 100%;
            height: auto;
        }

        .preview-legend {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 15px;
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .legend-color {
            width: 14px;
            height: 14px;
            border-radius: 4px;
        }

        /* Gender/Character Type Switch */
        .gender-switch {
            display: flex;
            gap: 5px;
            background: var(--input-bg);
            padding: 4px;
            border-radius: 20px;
            border: 1px solid var(--glass-border);
        }

        .gender-btn {
            padding: 8px 14px;
            border-radius: 16px;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            color: var(--text-muted);
            transition: 0.3s;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .gender-btn:hover {
            color: var(--text-bright);
        }

        .gender-btn.active {
            background: var(--secondary);
            color: #fff;
            box-shadow: 0 0 15px rgba(244, 114, 182, 0.5);
        }

        /* Text Position Switch */
        .txt-pos-switch {
            display: flex;
            gap: 5px;
            background: var(--input-bg);
            padding: 4px;
            border-radius: 20px;
            border: 1px solid var(--glass-border);
        }

        .txt-pos-btn {
            padding: 8px 12px;
            border-radius: 16px;
            font-size: 0.7rem;
            font-weight: 600;
            cursor: pointer;
            color: var(--text-muted);
            transition: 0.3s;
        }

        .txt-pos-btn:hover {
            color: var(--text-bright);
        }

        .txt-pos-btn.active {
            background: var(--accent);
            color: #000;
            box-shadow: 0 0 15px rgba(56, 189, 248, 0.5);
        }

        /* Presets Panel */
        .presets-container {
            margin: 25px 0;
            padding: 20px;
            background: var(--hud-bg);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
        }

        .presets-title {
            font-family: 'JetBrains Mono', monospace;
            color: var(--accent);
            font-size: 0.85rem;
            letter-spacing: 1px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .presets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
        }

        .preset-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 12px;
            cursor: pointer;
            transition: 0.3s;
            text-align: center;
        }

        .preset-btn:hover {
            background: rgba(139, 92, 246, 0.2);
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .preset-icon {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .preset-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            font-weight: 600;
        }

        /* Favorites */
        .fav-btn {
            background: transparent;
            border: 1px solid var(--glass-border);
            color: var(--text-muted);
            padding: 8px 14px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .fav-btn:hover {
            background: rgba(234, 179, 8, 0.2);
            border-color: var(--hud-border);
            color: var(--hud-border);
        }

        .fav-btn.saved {
            background: var(--hud-border);
            color: #000;
            border-color: var(--hud-border);
        }

        /* Export/Import Panel */
        .export-import-panel {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }

        .exp-imp-btn {
            flex: 1;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--glass-border);
            color: var(--text-muted);
            padding: 12px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .exp-imp-btn:hover {
            background: rgba(255, 255, 255, 0.08);
            color: var(--text-bright);
        }

        /* Prompt Stats */
        .prompt-stats {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            padding: 15px;
            background: var(--hud-bg);
            border-radius: 12px;
            border: 1px solid var(--glass-border);
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--accent);
        }

        .stat-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Keyboard Shortcuts Modal */
        .shortcuts-hint {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--hud-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 10px 15px;
            font-size: 0.75rem;
            color: var(--text-muted);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .kbd {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--glass-border);
            border-radius: 4px;
            padding: 2px 6px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary);
            color: #fff;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 0.85rem;
            font-weight: 600;
            z-index: 1001;
            animation: toastIn 0.3s ease;
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.5);
        }

        @keyframes toastIn {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        /* ARIA Focus Styles */
        *:focus-visible {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
        }

        /* Skip Link for A11y */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--primary);
            color: #fff;
            padding: 8px 16px;
            z-index: 100;
            transition: top 0.3s;
        }

        .skip-link:focus {
            top: 0;
        }

        /* Undo Toast */
        .undo-toast {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: #1e1e2e;
            border: 1px solid var(--glass-border);
            color: #fff;
            padding: 12px 20px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1001;
        }

        .undo-btn {
            background: var(--primary);
            color: #fff;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }

        /* Position Control Panel */
        .position-control-panel {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 25px;
            padding: 20px;
            background: var(--hud-bg);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            align-items: center;
            justify-content: center;
        }

        .position-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .position-label {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-muted);
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .drag-hint {
            font-size: 0.75rem;
            color: var(--accent);
            opacity: 0.8;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 0.5;
            }

            50% {
                opacity: 1;
            }
        }

        /* Draggable Canvas Elements */
        #preview-canvas {
            cursor: grab;
        }

        #preview-canvas:active {
            cursor: grabbing;
        }

        .canvas-drop-zone {
            position: absolute;
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            transition: 0.3s;
            pointer-events: none;
        }

        .canvas-drop-zone.active {
            border-color: var(--primary);
            background: rgba(139, 92, 246, 0.2);
        }
    </style>
</head>

<body>

    <!-- Skip Link for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <div class="container" id="main-content" role="main">
        <div class="header" role="banner">
            <h1>üé• THUMBNAIL STUDIO <span class="v8-badge">v2.0.0 FULL FEATURES</span></h1>

            <div class="ar-switch" role="group" aria-label="Aspect Ratio">
                <div class="ar-btn active" id="ar-169" onclick="setAr('16:9')" role="button" tabindex="0"
                    aria-pressed="true">16:9 (YOUTUBE)</div>
                <div class="ar-btn" id="ar-916" onclick="setAr('9:16')" role="button" tabindex="0" aria-pressed="false">
                    9:16 (SHORTS)</div>
            </div>

            <div class="gender-switch" role="group" aria-label="Character Type">
                <div class="gender-btn active" id="gender-male" onclick="setGender('male')" role="button" tabindex="0">
                    üë® <span id="txt-gender-male">ERKEK</span></div>
                <div class="gender-btn" id="gender-female" onclick="setGender('female')" role="button" tabindex="0">üë©
                    <span id="txt-gender-female">KADIN</span>
                </div>
                <div class="gender-btn" id="gender-char" onclick="setGender('character')" role="button" tabindex="0">ü§ñ
                    <span id="txt-gender-char">KARAKTER</span>
                </div>
            </div>

            <div class="header-controls">
                <button class="fav-btn" id="fav-btn" onclick="toggleFavorite()" aria-label="Save to favorites">‚≠ê <span
                        id="txt-fav">FAVORƒ∞</span></button>
                <button class="action-btn" onclick="toggleLang()">üá∫üá∏ EN / üáπüá∑ TR</button>
                <button class="action-btn btn-reset" onclick="resetAll()">üóëÔ∏è <span
                        id="txt-reset">SIFIRLA</span></button>
            </div>
        </div>

        <!-- Position Control Panel - Character & Text Together -->
        <div class="position-control-panel">
            <div class="position-group">
                <div class="position-label">üë§ <span id="lbl-char-pos">KARAKTER POZƒ∞SYONU</span></div>
                <div class="pos-switch" role="group" aria-label="Character Position">
                    <div class="pos-btn" id="pos-left" onclick="setPos('left')" role="button" tabindex="0">‚¨ÖÔ∏è <span
                            id="txt-pos-left">SOL</span></div>
                    <div class="pos-btn" id="pos-center" onclick="setPos('center')" role="button" tabindex="0">‚ö´ <span
                            id="txt-pos-center">ORTA</span></div>
                    <div class="pos-btn active" id="pos-right" onclick="setPos('right')" role="button" tabindex="0">‚û°Ô∏è
                        <span id="txt-pos-right">SAƒû</span>
                    </div>
                </div>
            </div>
            <div class="position-group">
                <div class="position-label">üÖ∞Ô∏è <span id="lbl-txt-pos">YAZI POZƒ∞SYONU</span></div>
                <div class="txt-pos-switch" role="group" aria-label="Text Position">
                    <div class="txt-pos-btn" id="txtpos-left" onclick="setTxtPos('left')" role="button" tabindex="0">‚óÄ
                        <span id="txt-txtpos-left">SOL</span>
                    </div>
                    <div class="txt-pos-btn" id="txtpos-top" onclick="setTxtPos('top')" role="button" tabindex="0">‚ñ≤
                        <span id="txt-txtpos-top">√úST</span>
                    </div>
                    <div class="txt-pos-btn active" id="txtpos-auto" onclick="setTxtPos('auto')" role="button"
                        tabindex="0">
                        ‚ö° <span id="txt-txtpos-auto">OTO</span></div>
                    <div class="txt-pos-btn" id="txtpos-bottom" onclick="setTxtPos('bottom')" role="button"
                        tabindex="0">‚ñº
                        <span id="txt-txtpos-bottom">ALT</span>
                    </div>
                    <div class="txt-pos-btn" id="txtpos-right" onclick="setTxtPos('right')" role="button" tabindex="0">‚ñ∂
                        <span id="txt-txtpos-right">SAƒû</span>
                    </div>
                </div>
            </div>
            <div class="drag-hint">
                <span id="drag-hint-text">üí° Canvas'ta elementleri s√ºr√ºkleyerek de pozisyon deƒüi≈ütirebilirsin!</span>
            </div>
        </div>

        <div class="mode-wrapper">
            <div class="mode-btn active" id="btn-ref" onclick="setMode('ref')">
                <i>üñºÔ∏è</i> <span id="txt-ref">KENDƒ∞ FOTOƒûRAFIM</span>
            </div>
            <div class="mode-btn" id="btn-rnd" onclick="setMode('rnd')">
                <i>üé≤</i> <span id="txt-rnd">RASTGELE KARAKTER</span>
            </div>
        </div>
        <div id="mode-desc"></div>

        <div class="grid">
            <div class="section">
                <div class="section-header">
                    <div class="section-title">üòÄ 1. Y√úZ ƒ∞FADESƒ∞</div>
                    <span class="count-badge" id="count-expr">0</span>
                </div>
                <div class="input-group">
                    <span class="input-icon">üé≠</span>
                    <input type="text" id="inp-expr" oninput="updateHud()">
                </div>
                <div class="chips-container" id="list-expr"></div>
            </div>

            <div class="section">
                <div class="section-header">
                    <div class="section-title">üëï 2. KIYAFET</div>
                    <span class="count-badge" id="count-outfit">0</span>
                </div>
                <div class="input-group">
                    <span class="input-icon">üëî</span>
                    <input type="text" id="inp-outfit" oninput="updateHud()">
                </div>
                <div class="chips-container" id="list-outfit"></div>
            </div>

            <div class="section">
                <div class="section-header">
                    <div class="section-title">ü§≤ 3. ELDEKƒ∞ NESNE</div>
                    <span class="count-badge" id="count-obj">0</span>
                </div>
                <div class="input-group">
                    <span class="input-icon">üéí</span>
                    <input type="text" id="inp-obj" oninput="updateHud()">
                </div>
                <div class="chips-container" id="list-obj"></div>
            </div>

            <div class="section">
                <div class="section-header">
                    <div class="section-title">üèôÔ∏è 4. ARKA PLAN</div>
                    <span class="count-badge" id="count-bg">0</span>
                </div>
                <div class="input-group">
                    <span class="input-icon">üó∫Ô∏è</span>
                    <input type="text" id="inp-bg" oninput="updateHud()">
                </div>
                <div class="chips-container" id="list-bg"></div>
            </div>

            <div class="section" style="grid-column: span 2;">
                <div class="section-header">
                    <div class="section-title">üÖ∞Ô∏è 5. SOLDAKƒ∞ YAZI</div>
                    <span class="count-badge" id="count-txt">0</span>
                </div>
                <div class="input-group">
                    <span class="input-icon">üí¨</span>
                    <input type="text" id="inp-txt" oninput="updateHud()">
                </div>
                <div class="chips-container" id="list-txt" style="height: 100px;"></div>
            </div>

            <div class="section">
                <div class="section-header">
                    <div class="section-title">üí° 6. I≈ûIK & MOD</div>
                    <span class="count-badge" id="count-light">0</span>
                </div>
                <div class="input-group">
                    <span class="input-icon">‚òÄÔ∏è</span>
                    <input type="text" id="inp-light" oninput="updateHud()">
                </div>
                <div class="chips-container" id="list-light" style="height: 120px;"></div>
            </div>

            <div class="section">
                <div class="section-header">
                    <div class="section-title">üé• 7. KAMERA A√áISI</div>
                    <span class="count-badge" id="count-angle">0</span>
                </div>
                <div class="input-group">
                    <span class="input-icon">üìê</span>
                    <input type="text" id="inp-angle" oninput="updateHud()">
                </div>
                <div class="chips-container" id="list-angle" style="height: 120px;"></div>
            </div>

            <div class="section" style="grid-column: span 2;">
                <div class="section-header">
                    <div class="section-title">‚ú® 8. G√ñRSEL EFEKTLER (FX)</div>
                    <span class="count-badge" id="count-fx">0</span>
                </div>
                <div class="input-group">
                    <span class="input-icon">‚ö°</span>
                    <input type="text" id="inp-fx" oninput="updateHud()">
                </div>
                <div class="chips-container" id="list-fx" style="height: 100px;"></div>
            </div>

        </div>

        <div class="hud-panel">
            <div class="hud-title">‚öôÔ∏è SYSTEM_MONITOR // LIVE_PREVIEW</div>
            <div class="hud-grid">
                <div class="hud-item">
                    <span class="hud-label" id="hl-mode">SOURCE</span>
                    <span class="hud-value" id="hv-mode" style="color:#eab308">PHOTO_REF</span>
                </div>
                <div class="hud-item">
                    <span class="hud-label" id="hl-pos">POSITION</span>
                    <span class="hud-value" id="hv-pos" style="color:#f472b6">RIGHT</span>
                </div>
                <div class="hud-item">
                    <span class="hud-label" id="hl-expr">EXPRESSION</span>
                    <span class="hud-value" id="hv-expr">N/A</span>
                </div>
                <div class="hud-item">
                    <span class="hud-label" id="hl-outfit">OUTFIT</span>
                    <span class="hud-value" id="hv-outfit">N/A</span>
                </div>
                <div class="hud-item">
                    <span class="hud-label" id="hl-obj">OBJECT</span>
                    <span class="hud-value" id="hv-obj">N/A</span>
                </div>
                <div class="hud-item">
                    <span class="hud-label" id="hl-bg">BG</span>
                    <span class="hud-value" id="hv-bg">N/A</span>
                </div>
                <div class="hud-item">
                    <span class="hud-label" id="hl-light">LIGHT</span>
                    <span class="hud-value" id="hv-light">N/A</span>
                </div>
                <div class="hud-item">
                    <span class="hud-label" id="hl-txt">TEXT</span>
                    <span class="hud-value" id="hv-txt" style="color:#38bdf8">N/A</span>
                </div>
            </div>
        </div>

        <div class="preview-container">
            <div class="preview-title">üñºÔ∏è <span id="txt-preview-title">√ñNƒ∞ZLEME // LAYOUT PREVIEW</span></div>
            <canvas id="preview-canvas" width="640" height="360"></canvas>
            <div class="preview-legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #8b5cf6;"></div>
                    <span id="legend-char">Karakter</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #38bdf8;"></div>
                    <span id="legend-text">Yazƒ±</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: rgba(255,255,255,0.1);"></div>
                    <span id="legend-bg">Arka Plan</span>
                </div>
            </div>
        </div>

        <button class="btn-gen" id="btn-gen" onclick="generate()">INITIALIZE PROMPT GENERATION</button>

        <div class="output-container">
            <textarea id="output" readonly></textarea>
            <button class="copy-btn" onclick="copyResult()">
                <i>üìã</i> KOPYALA
            </button>
        </div>

        <div class="history-container">
            <div class="history-header">
                <div class="history-title">üìú <span id="txt-history">GE√áMƒ∞≈û PROMPTLAR</span></div>
                <button class="h-btn" onclick="clearHistory()" id="btn-clear-hist" style="font-size:0.7rem">T√úM√úN√ú
                    Sƒ∞L</button>
            </div>
            <div class="history-list" id="history-list">
            </div>
        </div>

        <!-- Presets Panel -->
        <div class="presets-container">
            <div class="presets-title">üé® <span id="txt-presets-title">HAZIR ≈ûABLONLAR // QUICK PRESETS</span></div>
            <div class="presets-grid" id="presets-grid">
                <div class="preset-btn" onclick="applyPreset('clickbait')">
                    <div class="preset-icon">üî•</div>
                    <div class="preset-label" id="preset-clickbait">CLICKBAIT</div>
                </div>
                <div class="preset-btn" onclick="applyPreset('minimal')">
                    <div class="preset-icon">‚ú®</div>
                    <div class="preset-label" id="preset-minimal">Mƒ∞Nƒ∞MAL</div>
                </div>
                <div class="preset-btn" onclick="applyPreset('gaming')">
                    <div class="preset-icon">üéÆ</div>
                    <div class="preset-label" id="preset-gaming">GAMING</div>
                </div>
                <div class="preset-btn" onclick="applyPreset('tutorial')">
                    <div class="preset-icon">üìö</div>
                    <div class="preset-label" id="preset-tutorial">TUTORIAL</div>
                </div>
                <div class="preset-btn" onclick="applyPreset('vlog')">
                    <div class="preset-icon">üé¨</div>
                    <div class="preset-label" id="preset-vlog">VLOG</div>
                </div>
                <div class="preset-btn" onclick="applyPreset('mystery')">
                    <div class="preset-icon">üîÆ</div>
                    <div class="preset-label" id="preset-mystery">Gƒ∞ZEM</div>
                </div>
                <div class="preset-btn" onclick="applyPreset('money')">
                    <div class="preset-icon">üí∞</div>
                    <div class="preset-label" id="preset-money">PARA/Fƒ∞NANS</div>
                </div>
                <div class="preset-btn" onclick="applyPreset('horror')">
                    <div class="preset-icon">üëª</div>
                    <div class="preset-label" id="preset-horror">KORKU</div>
                </div>
            </div>
        </div>

        <!-- Export/Import Panel -->
        <div class="export-import-panel">
            <button class="exp-imp-btn" onclick="exportSettings()">
                üì§ <span id="txt-export">AYARLARI DI≈ûA AKTAR</span>
            </button>
            <button class="exp-imp-btn" onclick="importSettings()">
                üì• <span id="txt-import">AYARLARI ƒ∞√áE AKTAR</span>
            </button>
        </div>

        <!-- Prompt Stats -->
        <div class="prompt-stats" id="prompt-stats" style="display: none;">
            <div class="stat-item">
                <span class="stat-value" id="stat-chars">0</span>
                <span class="stat-label" id="stat-chars-label">KARAKTER</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="stat-words">0</span>
                <span class="stat-label" id="stat-words-label">KELƒ∞ME</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="stat-tokens">0</span>
                <span class="stat-label" id="stat-tokens-label">TOKEN (‚âà)</span>
            </div>
        </div>

    </div>

    <!-- Keyboard Shortcuts Hint -->
    <div class="shortcuts-hint" id="shortcuts-hint">
        <kbd class="kbd">Ctrl</kbd>+<kbd class="kbd">Enter</kbd> <span id="txt-shortcut-gen">Olu≈ütur</span> |
        <kbd class="kbd">Ctrl</kbd>+<kbd class="kbd">C</kbd> <span id="txt-shortcut-copy">Kopyala</span>
    </div>

    <!-- Hidden file input for import -->
    <input type="file" id="import-file" accept=".json" style="display:none" onchange="handleImport(event)">

    <script>
        // =========================================
        // *** DATASET v1.0.0 (INITIAL RELEASE) ***
        // =========================================
        const dataPool = {
            tr: {
                modeRefTxt: "KENDƒ∞ FOTOƒûRAFIM (Varsayƒ±lan)",
                modeRndTxt: "RASTGELE KARAKTER",
                modeDescRef: "‚ÑπÔ∏è Prompt'a fotoƒürafƒ±nƒ± eklemelisin. Y√ºz√ºn korunur, ortam deƒüi≈üir.",
                modeDescRnd: "‚ö†Ô∏è Prompt rastgele bir karakter tarifi olu≈üturur.",
                placeholders: ["√ñrn: ≈ûa≈ükƒ±n...", "√ñrn: Siyah Hoodie...", "√ñrn: Para...", "√ñrn: St√ºdyo...", "√ñrn: YAZI", "√ñrn: Sinematik...", "√ñrn: Geni≈ü A√ßƒ±...", "√ñrn: Kƒ±vƒ±lcƒ±m..."],
                hudLabels: ["KAYNAK", "POZƒ∞SYON", "ƒ∞FADE", "KIYAFET", "NESNE", "MEKAN", "YAZI", "I≈ûIK", "A√áI", "EFEKT"],
                posLabels: { left: "SOL", center: "ORTA", right: "SAƒû" },
                posHudLabel: "POZƒ∞SYON",
                genderLabels: { male: "ERKEK", female: "KADIN", character: "KARAKTER" },
                genderHudLabel: "Cƒ∞NSƒ∞YET",
                txtPosLabels: { left: "SOL", top: "√úST", auto: "OTO", bottom: "ALT", right: "SAƒû" },
                txtPosHudLabel: "YAZI POZ.",
                btnGen: "PROMPT OLU≈ûTUR (BA≈ûLAT)",
                txtReset: "SIFIRLA",
                txtHistory: "GE√áMƒ∞≈û PROMPTLAR",
                txtFav: "FAVORƒ∞",
                txtExport: "AYARLARI DI≈ûA AKTAR",
                txtImport: "AYARLARI ƒ∞√áE AKTAR",
                txtPresets: "HAZIR ≈ûABLONLAR // QUICK PRESETS",
                presetLabels: { clickbait: "CLICKBAIT", minimal: "Mƒ∞Nƒ∞MAL", gaming: "GAMING", tutorial: "TUTORIAL", vlog: "VLOG", mystery: "Gƒ∞ZEM", money: "PARA/Fƒ∞NANS", horror: "KORKU" },
                statLabels: { chars: "KARAKTER", words: "KELƒ∞ME", tokens: "TOKEN (‚âà)" },
                shortcutLabels: { gen: "Olu≈ütur", copy: "Kopyala" },

                expr: [
                    { i: "üò±", l: "≈ûok Olmu≈ü" }, { i: "üòä", l: "Mutlu" }, { i: "ü§¨", l: "√áok Sinirli" }, { i: "üò≠", l: "Aƒülayan" }, { i: "ü§î", l: "D√º≈ü√ºnceli" },
                    { i: "ü§Ø", l: "Beyni Yanmƒ±≈ü" }, { i: "ü§ë", l: "Para G√∂zl√º" }, { i: "üòà", l: "Sinsi/K√∂t√º" }, { i: "üò¥", l: "Uykulu" }, { i: "üò®", l: "Deh≈üete D√º≈üm√º≈ü" },
                    { i: "ü§ê", l: "Aƒüzƒ± Bantlƒ±" }, { i: "ü§°", l: "Palya√ßo" }, { i: "üòé", l: "Havalƒ±" }, { i: "ü§ï", l: "Yaralƒ±" }, { i: "üßê", l: "ƒ∞nceleyen" },
                    { i: "ü§¢", l: "ƒ∞ƒürenmi≈ü" }, { i: "ü§£", l: "Kahkaha Atan" }, { i: "üò§", l: "Kararlƒ±" }, { i: "üôÑ", l: "G√∂z Deviren" }, { i: "ü•∫", l: "Masum/Yalvaran" },
                    { i: "üòµ", l: "Baygƒ±n" }, { i: "ü§™", l: "√áƒ±lgƒ±n" }, { i: "ü§•", l: "Yalancƒ± (Burnu Uzun)" }, { i: "ü§´", l: "Sus ƒ∞≈üareti" }, { i: "üò¨", l: "Gergin" }
                ],
                outfit: [
                    { i: "üß•", l: "Siyah Hoodie" }, { i: "üëî", l: "Takƒ±m Elbise" }, { i: "üîß", l: "ƒ∞≈ü Tulumu" }, { i: "üëï", l: "T-Shirt" }, { i: "üëÆ", l: "Polis" },
                    { i: "ü©∫", l: "Doktor" }, { i: "ü™ñ", l: "Askeri" }, { i: "‚õìÔ∏è", l: "Mahkum" }, { i: "üë®‚Äçüç≥", l: "A≈ü√ßƒ±" }, { i: "üï¥Ô∏è", l: "Smokin" },
                    { i: "üßü", l: "Zombi" }, { i: "ü¶∏", l: "S√ºper Kahraman" }, { i: "üèãÔ∏è", l: "Sporcu/Atlet" }, { i: "ü•ã", l: "D√∂v√º≈ü√ß√º" }, { i: "üß™", l: "Laboratuvar √ñnl√ºƒü√º" },
                    { i: "üß•", l: "Deri Ceket" }, { i: "üöÄ", l: "Astronot" }, { i: "ü§¥", l: "Kraliyet Giysisi" }, { i: "üëò", l: "Cyberpunk Ceket" }, { i: "üèñÔ∏è", l: "Hawaii G√∂mleƒüi" },
                    { i: "üëó", l: "Abiye Elbise" }, { i: "üï∂Ô∏è", l: "Ajan (Siyah Takƒ±m)" }, { i: "ü¶Å", l: "K√ºrk Mantolu" }
                ],
                obj: [
                    { i: "üì±", l: "Telefon" }, { i: "üíµ", l: "Para Destesi" }, { i: "üíª", l: "Laptop" }, { i: "üéÆ", l: "Oyun Kolu" }, { i: "üö™", l: "Kapƒ± Hidroliƒüi" },
                    { i: "‚ùì", l: "Gizemli Kutu" }, { i: "üçî", l: "Hamburger" }, { i: "üé§", l: "Mikrofon" }, { i: "üì∏", l: "Kamera" }, { i: "üöÅ", l: "Drone" },
                    { i: "‚Çø", l: "Bitcoin" }, { i: "üèÜ", l: "Kupa" }, { i: "üî´", l: "Oyuncak Silah" }, { i: "üí≥", l: "Kredi Kartƒ±" }, { i: "üï∂Ô∏è", l: "VR G√∂zl√ºk" },
                    { i: "üèéÔ∏è", l: "Direksiyon" }, { i: "üíä", l: "Hap/ƒ∞la√ß" }, { i: "üß±", l: "Altƒ±n K√ºl√ße" }, { i: "‚è±Ô∏è", l: "Kronometre" }, { i: "üîç", l: "B√ºy√ºte√ß" },
                    { i: "ü•§", l: "Enerji ƒ∞√ßeceƒüi" }, { i: "üéà", l: "Kƒ±rmƒ±zƒ± Balon" }, { i: "üéÅ", l: "Hediye Paketi" }, { i: "üå∂Ô∏è", l: "Acƒ± Biber" }
                ],
                bg: [
                    { i: "üéôÔ∏è", l: "Neon St√ºdyo" }, { i: "üè†", l: "Ev Salonu" }, { i: "üç≥", l: "L√ºks Mutfak" }, { i: "üëæ", l: "Oyun Odasƒ±" }, { i: "üñ•Ô∏è", l: "Ofis" },
                    { i: "üõ†Ô∏è", l: "At√∂lye" }, { i: "üöî", l: "Hapishane" }, { i: "üå≤", l: "Orman" }, { i: "üèöÔ∏è", l: "Harabe" }, { i: "üåå", l: "Uzay" }, { i: "üèôÔ∏è", l: "≈ûehir" },
                    { i: "‚úàÔ∏è", l: "√ñzel Jet" }, { i: "üõí", l: "S√ºpermarket" }, { i: "üèãÔ∏è", l: "Spor Salonu" }, { i: "üéì", l: "Sƒ±nƒ±f/Okul" }, { i: "‚öñÔ∏è", l: "Mahkeme" },
                    { i: "üèñÔ∏è", l: "Plaj" }, { i: "üèéÔ∏è", l: "Yarƒ±≈ü Pisti" }, { i: "üåã", l: "Volkanik Alan" }, { i: "üè•", l: "Hastane Odasƒ±" }, { i: "üè¶", l: "Banka Kasasƒ±" },
                    { i: "üõÅ", l: "L√ºks Banyo" }, { i: "üèúÔ∏è", l: "√á√∂l" }, { i: "üõ•Ô∏è", l: "Yat G√ºvertesi" }
                ],
                txt: [
                    { i: "‚ùì", l: "NASIL?" }, { i: "üîé", l: "ƒ∞NCELEME" }, { i: "üö´", l: "SAKIN YAPMA" }, { i: "üí°", l: "GER√áEKLER" }, { i: "ü§•", l: "YALAN MI?" },
                    { i: "‚ö†Ô∏è", l: "DOLANDIRICI" }, { i: "üí∏", l: "ƒ∞FLAS" }, { i: "ü§ë", l: "ZENGƒ∞N OLDUM" }, { i: "‚è≥", l: "24 SAAT" }, { i: "üÜö", l: "KIYASLAMA" },
                    { i: "üî•", l: "√áOK Rƒ∞SKLƒ∞" }, { i: "üõë", l: "DUR!" }, { i: "üò±", l: "ƒ∞NANILMAZ" }, { i: "üí∞", l: "100.000$" }, { i: "üÜì", l: "BEDAVA" },
                    { i: "üß™", l: "DENEY" }, { i: "üîí", l: "Gƒ∞ZLƒ∞" }, { i: "‚ùå", l: "HATA YAPTIM" }, { i: "üìà", l: "YATIRIM" }, { i: "üèÜ", l: "KAZANDIM" }
                ],
                light: [
                    { i: "üü¶", l: "Teal & Orange (Sinematik)" }, { i: "üü£", l: "Neon Cyberpunk (Mor/Mavi)" }, { i: "üåë", l: "Rembrandt (Karanlƒ±k)" },
                    { i: "üí°", l: "High Key (Parlak/Temiz)" }, { i: "ü§¢", l: "Korku (Ye≈üil/Toksik)" }, { i: "üåÖ", l: "Golden Hour (G√ºne≈üli)" },
                    { i: "üî¶", l: "Rim Light (Kenar I≈üƒ±ƒüƒ±)" }, { i: "üå©Ô∏è", l: "Dramatik Fƒ±rtƒ±na" }, { i: "üïØÔ∏è", l: "Mum I≈üƒ±ƒüƒ± (Sƒ±cak)" }, { i: "üåà", l: "RGB Split (Renkli)" },
                    { i: "‚ö´", l: "Siyah Beyaz (Noir)" }, { i: "‚ú®", l: "H√ºzme I≈üƒ±klar (God Rays)" }
                ],
                angle: [
                    { i: "üòê", l: "G√∂z Hizasƒ± (Normal)" }, { i: "üêü", l: "Geni≈ü A√ßƒ± (GoPro)" }, { i: "ü¶∏", l: "Alttan Bakƒ±≈ü (Kahraman)" },
                    { i: "üîç", l: "Yakƒ±n √áekim (Duygusal)" }, { i: "üöÅ", l: "√ústten Bakƒ±≈ü (Drone)" }, { i: "ü§≥", l: "Selfie A√ßƒ±sƒ±" },
                    { i: "üìê", l: "Dutch Angle (Eƒüik)" }, { i: "üêú", l: "Makro (√áok Yakƒ±n)" }, { i: "üë•", l: "Omuz √úst√º (Over Shoulder)" }
                ],
                fx: [
                    { i: "‚ú®", l: "Temiz (Efekt Yok)" }, { i: "üí®", l: "Toz Zerrecikleri" }, { i: "üî•", l: "Ate≈ü Kƒ±vƒ±lcƒ±mlarƒ±" }, { i: "üí∏", l: "Yaƒüan Paralar" },
                    { i: "üíª", l: "Matrix Kodlarƒ±" }, { i: "‚ö°", l: "Elektrik/Yƒ±ldƒ±rƒ±m" }, { i: "üå´Ô∏è", l: "Duman/Sis" },
                    { i: "üíß", l: "Su Sƒ±√ßramasƒ±" }, { i: "üí•", l: "Patlama" }, { i: "üì∑", l: "Bokeh (Arka Plan Bulanƒ±k)" }, { i: "üì∫", l: "Glitch (Bozulma)" },
                    { i: "‚ùÑÔ∏è", l: "Kar Tanesi/Buz" }, { i: "üé®", l: "Yaƒülƒ± Boya Dokusu" }, { i: "üï∏Ô∏è", l: "√ñr√ºmcek Aƒülarƒ±" }
                ]
            },
            en: {
                modeRefTxt: "MY PHOTO (Default)",
                modeRndTxt: "RANDOM CHARACTER",
                modeDescRef: "‚ÑπÔ∏è Attach your photo with the prompt. Face is kept, scene changes.",
                modeDescRnd: "‚ö†Ô∏è Prompt generates a random character description.",
                placeholders: ["e.g. Shocked...", "e.g. Hoodie...", "e.g. Money...", "e.g. Studio...", "e.g. TEXT", "e.g. Cinematic...", "e.g. Wide Angle...", "e.g. Fire..."],
                hudLabels: ["SOURCE", "POSITION", "EXPRESSION", "OUTFIT", "OBJECT", "ENVIRONMENT", "OVERLAY", "LIGHT", "ANGLE", "FX"],
                posLabels: { left: "LEFT", center: "CENTER", right: "RIGHT" },
                posHudLabel: "POSITION",
                genderLabels: { male: "MALE", female: "FEMALE", character: "CHARACTER" },
                genderHudLabel: "GENDER",
                txtPosLabels: { left: "LEFT", top: "TOP", auto: "AUTO", bottom: "BOTTOM", right: "RIGHT" },
                txtPosHudLabel: "TEXT POS.",
                btnGen: "GENERATE PROMPT (INITIALIZE)",
                txtReset: "RESET",
                txtHistory: "PROMPT HISTORY",
                txtFav: "FAVORITE",
                txtExport: "EXPORT SETTINGS",
                txtImport: "IMPORT SETTINGS",
                txtPresets: "QUICK PRESETS // TEMPLATES",
                presetLabels: { clickbait: "CLICKBAIT", minimal: "MINIMAL", gaming: "GAMING", tutorial: "TUTORIAL", vlog: "VLOG", mystery: "MYSTERY", money: "MONEY/FINANCE", horror: "HORROR" },
                statLabels: { chars: "CHARACTERS", words: "WORDS", tokens: "TOKEN (‚âà)" },
                shortcutLabels: { gen: "Generate", copy: "Copy" },

                expr: [
                    { i: "üò±", l: "Shocked" }, { i: "üòä", l: "Happy" }, { i: "ü§¨", l: "Angry" }, { i: "üò≠", l: "Crying" }, { i: "ü§î", l: "Thinking" },
                    { i: "ü§Ø", l: "Mind Blown" }, { i: "ü§ë", l: "Greedy" }, { i: "üòà", l: "Evil smirk" }, { i: "üò¥", l: "Sleepy" }, { i: "üò®", l: "Terrified" },
                    { i: "ü§ê", l: "Mouth taped shut" }, { i: "ü§°", l: "Clown face" }, { i: "üòé", l: "Cool wearing sunglasses" }, { i: "ü§ï", l: "Injured with bandages" }, { i: "üßê", l: "Focused and analyzing" },
                    { i: "ü§¢", l: "Disgusted" }, { i: "ü§£", l: "Laughing hysterically" }, { i: "üò§", l: "Determined" }, { i: "üôÑ", l: "Rolling eyes" }, { i: "ü•∫", l: "Pleading puppy eyes" },
                    { i: "üòµ", l: "Unconscious" }, { i: "ü§™", l: "Crazy tongue out" }, { i: "ü§•", l: "Lying with long nose" }, { i: "ü§´", l: "Shushing finger on lips" }, { i: "üò¨", l: "Awkward grimace" }
                ],
                outfit: [
                    { i: "üß•", l: "Black Hoodie" }, { i: "üëî", l: "Luxury Suit" }, { i: "üîß", l: "Blue Overalls" }, { i: "üëï", l: "White T-Shirt" }, { i: "üëÆ", l: "Police Uniform" },
                    { i: "ü©∫", l: "Doctor Coat" }, { i: "ü™ñ", l: "Military Gear" }, { i: "‚õìÔ∏è", l: "Prisoner Jumpsuit" }, { i: "üë®‚Äçüç≥", l: "Chef Uniform" }, { i: "üï¥Ô∏è", l: "Tuxedo" },
                    { i: "üßü", l: "Zombie Clothes" }, { i: "ü¶∏", l: "Superhero Costume" }, { i: "üèãÔ∏è", l: "Gym Sportswear" }, { i: "ü•ã", l: "MMA Fighter Gear" }, { i: "üß™", l: "White Lab Coat" },
                    { i: "üß•", l: "Leather Biker Jacket" }, { i: "üöÄ", l: "NASA Astronaut Suit" }, { i: "ü§¥", l: "Royal King Robe" }, { i: "üëò", l: "Futuristic Cyberpunk Jacket" }, { i: "üèñÔ∏è", l: "Floral Hawaiian Shirt" },
                    { i: "üëó", l: "Elegant Evening Gown" }, { i: "üï∂Ô∏è", l: "Secret Agent Black Suit" }, { i: "ü¶Å", l: "Extravagant Fur Coat" }
                ],
                obj: [
                    { i: "üì±", l: "Glowing Phone" }, { i: "üíµ", l: "Stack of Money" }, { i: "üíª", l: "Laptop" }, { i: "üéÆ", l: "Gamepad" }, { i: "üö™", l: "Door Closer" },
                    { i: "‚ùì", l: "Mystery Box" }, { i: "üçî", l: "Giant Burger" }, { i: "üé§", l: "Microphone" }, { i: "üì∏", l: "Camera" }, { i: "üöÅ", l: "Drone" },
                    { i: "‚Çø", l: "Bitcoin Coin" }, { i: "üèÜ", l: "Golden Trophy" }, { i: "üî´", l: "Toy Nerf Gun" }, { i: "üí≥", l: "Black Credit Card" }, { i: "üï∂Ô∏è", l: "VR Headset" },
                    { i: "üèéÔ∏è", l: "Racing Steering Wheel" }, { i: "üíä", l: "Red and Blue Pills" }, { i: "üß±", l: "Gold Bars" }, { i: "‚è±Ô∏è", l: "Stopwatch" }, { i: "üîç", l: "Magnifying Glass" },
                    { i: "ü•§", l: "Energy Drink Can" }, { i: "üéà", l: "Red Balloon" }, { i: "üéÅ", l: "Wrapped Gift Box" }, { i: "üå∂Ô∏è", l: "Hot Chili Pepper" }
                ],
                bg: [
                    { i: "üéôÔ∏è", l: "Neon Studio" }, { i: "üè†", l: "Living Room" }, { i: "üç≥", l: "Luxury Kitchen" }, { i: "üëæ", l: "Gaming Room" }, { i: "üñ•Ô∏è", l: "Office" },
                    { i: "üõ†Ô∏è", l: "Workshop" }, { i: "üöî", l: "Jail Cell" }, { i: "üå≤", l: "Dark Forest" }, { i: "üèöÔ∏è", l: "Abandoned Ruins" }, { i: "üåå", l: "Outer Space" }, { i: "üèôÔ∏è", l: "City Skyline" },
                    { i: "‚úàÔ∏è", l: "Private Jet Interior" }, { i: "üõí", l: "Supermarket Aisle" }, { i: "üèãÔ∏è", l: "Gym Background" }, { i: "üéì", l: "University Classroom" }, { i: "‚öñÔ∏è", l: "Courtroom" },
                    { i: "üèñÔ∏è", l: "Sunny Beach" }, { i: "üèéÔ∏è", l: "F1 Racetrack" }, { i: "üåã", l: "Volcanic Landscape" }, { i: "üè•", l: "Hospital Room" }, { i: "üè¶", l: "Bank Vault" },
                    { i: "üõÅ", l: "Luxury Bathroom" }, { i: "üèúÔ∏è", l: "Sahara Desert" }, { i: "üõ•Ô∏è", l: "Yacht Deck" }
                ],
                txt: [
                    { i: "‚ùì", l: "HOW TO?" }, { i: "üîé", l: "REVIEW" }, { i: "üö´", l: "DON'T DO IT" }, { i: "üí°", l: "THE TRUTH" }, { i: "ü§•", l: "FAKE?" },
                    { i: "‚ö†Ô∏è", l: "SCAMMER" }, { i: "üí∏", l: "BANKRUPT" }, { i: "ü§ë", l: "I'M RICH" }, { i: "‚è≥", l: "24 HOURS" }, { i: "üÜö", l: "VS" },
                    { i: "üî•", l: "HIGH RISK" }, { i: "üõë", l: "STOP!" }, { i: "üò±", l: "UNBELIEVABLE" }, { i: "üí∞", l: "$100,000" }, { i: "üÜì", l: "FOR FREE" },
                    { i: "üß™", l: "EXPERIMENT" }, { i: "üîí", l: "SECRET" }, { i: "‚ùå", l: "HUGE MISTAKE" }, { i: "üìà", l: "INVESTING" }, { i: "üèÜ", l: "I WON" }
                ],
                light: [
                    { i: "üü¶", l: "dramatic teal and orange cinematic lighting" },
                    { i: "üü£", l: "vibrant neon cyberpunk pink and blue lighting" },
                    { i: "üåë", l: "moody dark rembrandt lighting, high contrast" },
                    { i: "üí°", l: "bright high-key studio lighting, clean white look" },
                    { i: "ü§¢", l: "eerie green toxic horror lighting" },
                    { i: "üåÖ", l: "warm golden hour sunset lighting" },
                    { i: "üî¶", l: "sharp rim lighting outlining the subject" },
                    { i: "üå©Ô∏è", l: "dramatic stormy lightning flashes" },
                    { i: "üïØÔ∏è", l: "warm candlelight low light" },
                    { i: "üåà", l: "RGB split color lighting effect" },
                    { i: "‚ö´", l: "black and white film noir lighting" },
                    { i: "‚ú®", l: "volumetric god rays shining through" }
                ],
                angle: [
                    { i: "üòê", l: "eye-level shot" },
                    { i: "üêü", l: "wide-angle fish-eye lens effect" },
                    { i: "ü¶∏", l: "low-angle hero shot looking up" },
                    { i: "üîç", l: "extreme close-up shot on face" },
                    { i: "üöÅ", l: "high-angle drone shot looking down" },
                    { i: "ü§≥", l: "selfie style camera angle holding camera" },
                    { i: "üìê", l: "tilted dutch angle shot" },
                    { i: "üêú", l: "macro photography shot" },
                    { i: "üë•", l: "over-the-shoulder cinematic shot" }
                ],
                fx: [
                    { i: "‚ú®", l: "clean sharp focus, no particles" },
                    { i: "üí®", l: "floating cinematic dust particles" },
                    { i: "üî•", l: "flying fire sparks and embers" },
                    { i: "üí∏", l: "falling dollar bills raining down" },
                    { i: "üíª", l: "green digital matrix code rain overlay" },
                    { i: "‚ö°", l: "blue lightning bolts and electricity" },
                    { i: "üå´Ô∏è", l: "thick volumetric fog and smoke" },
                    { i: "üíß", l: "water splashing droplets frozen in air" },
                    { i: "üí•", l: "explosive background debris" },
                    { i: "üì∑", l: "bokeh depth of field background blur" },
                    { i: "üì∫", l: "digital glitch distortion effect" },
                    { i: "‚ùÑÔ∏è", l: "falling snow and ice particles" },
                    { i: "üé®", l: "oil painting texture overlay" },
                    { i: "üï∏Ô∏è", l: "cobwebs and dusty atmosphere" }
                ]
            }
        };

        // =========================
        // *** APP LOGIC ***
        // =========================
        let currentLang = 'tr';
        let currentMode = 'ref';
        let currentAr = '16:9';
        let currentPos = 'right';
        let currentGender = 'male';
        let currentTxtPos = 'auto';
        let promptHistory = [];
        let favorites = [];
        let undoStack = [];
        let isFavorite = false;

        // Preset definitions
        const presets = {
            clickbait: { expr: 'Shocked', outfit: 'Black Hoodie', obj: 'Stack of Money', bg: 'Neon Studio', txt: 'OMG!', light: 'dramatic teal and orange cinematic lighting', angle: 'wide angle gopro style', fx: 'floating dust particles' },
            minimal: { expr: 'Happy', outfit: 'White T-Shirt', obj: '', bg: 'clean studio', txt: '', light: 'bright high-key studio lighting', angle: 'eye level portrait', fx: 'clean no effects' },
            gaming: { expr: 'Mind Blown', outfit: 'Gaming headset', bg: 'Gaming Room', obj: 'Gamepad', txt: 'EPIC', light: 'vibrant neon cyberpunk pink and blue lighting', angle: 'dutch angle tilted', fx: 'digital glitch distortion effect' },
            tutorial: { expr: 'Thinking', outfit: 'Casual smart', bg: 'Office', obj: 'Laptop', txt: 'HOW TO', light: 'bright high-key studio lighting', angle: 'eye level portrait', fx: 'clean no effects' },
            vlog: { expr: 'Happy', outfit: 'Casual', bg: 'Living Room', obj: '', txt: '', light: 'warm golden hour sunset lighting', angle: 'selfie angle', fx: 'bokeh depth of field' },
            mystery: { expr: 'Suspicious', outfit: 'Dark hoodie', bg: 'Dark alley', obj: 'Mystery Box', txt: 'THE TRUTH', light: 'moody dark rembrandt lighting', angle: 'dutch angle tilted', fx: 'floating dust particles' },
            money: { expr: 'Greedy', outfit: 'Luxury Suit', bg: 'Bank Vault', obj: 'Stack of Money', txt: '$100,000', light: 'dramatic teal and orange cinematic lighting', angle: 'low angle hero shot', fx: 'floating money bills' },
            horror: { expr: 'Terrified', outfit: 'Torn clothes', bg: 'Abandoned house', obj: '', txt: 'RUN!', light: 'eerie green toxic horror lighting', angle: 'dutch angle tilted', fx: 'fog and mist atmosphere' }
        };

        function init() {
            renderUI();
            setMode('ref');
            setAr('16:9');
            setPos('right');
            setGender('male');
            setTxtPos('auto');
            loadHistory();
            loadFavorites();
            drawPreview();
            setupKeyboardShortcuts();
            setupCanvasDrag();
        }

        function renderUI() {
            const d = dataPool[currentLang];

            // Static Texts
            document.getElementById('txt-ref').innerText = d.modeRefTxt;
            document.getElementById('txt-rnd').innerText = d.modeRndTxt;
            document.getElementById('btn-gen').innerText = d.btnGen;
            document.getElementById('txt-reset').innerText = d.txtReset;
            document.getElementById('txt-history').innerText = d.txtHistory;
            document.getElementById('btn-clear-hist').innerText = currentLang === 'tr' ? "T√úM√úN√ú Sƒ∞L" : "CLEAR ALL";

            // New UI texts
            document.getElementById('txt-fav').innerText = d.txtFav;
            document.getElementById('txt-export').innerText = d.txtExport;
            document.getElementById('txt-import').innerText = d.txtImport;
            document.getElementById('txt-presets-title').innerText = d.txtPresets;
            document.getElementById('txt-shortcut-gen').innerText = d.shortcutLabels.gen;
            document.getElementById('txt-shortcut-copy').innerText = d.shortcutLabels.copy;

            // Update gender labels
            document.getElementById('txt-gender-male').innerText = d.genderLabels.male;
            document.getElementById('txt-gender-female').innerText = d.genderLabels.female;
            document.getElementById('txt-gender-char').innerText = d.genderLabels.character;

            // Update text position labels
            document.getElementById('txt-txtpos-left').innerText = d.txtPosLabels.left;
            document.getElementById('txt-txtpos-top').innerText = d.txtPosLabels.top;
            document.getElementById('txt-txtpos-auto').innerText = d.txtPosLabels.auto;
            document.getElementById('txt-txtpos-bottom').innerText = d.txtPosLabels.bottom;
            document.getElementById('txt-txtpos-right').innerText = d.txtPosLabels.right;

            // Update preset labels
            Object.keys(d.presetLabels).forEach(key => {
                const el = document.getElementById(`preset-${key}`);
                if (el) el.innerText = d.presetLabels[key];
            });

            // Update stat labels
            document.getElementById('stat-chars-label').innerText = d.statLabels.chars;
            document.getElementById('stat-words-label').innerText = d.statLabels.words;
            document.getElementById('stat-tokens-label').innerText = d.statLabels.tokens;

            // Update preview on language change
            if (typeof drawPreview === 'function') drawPreview();

            // Update position control labels
            document.getElementById('lbl-char-pos').innerText = currentLang === 'tr' ? 'KARAKTER POZƒ∞SYONU' : 'CHARACTER POSITION';
            document.getElementById('lbl-txt-pos').innerText = currentLang === 'tr' ? 'YAZI POZƒ∞SYONU' : 'TEXT POSITION';
            document.getElementById('drag-hint-text').innerText = currentLang === 'tr'
                ? 'üí° Canvas\'ta elementleri s√ºr√ºkleyerek de pozisyon deƒüi≈ütirebilirsin!'
                : 'üí° You can also drag elements on the canvas to change positions!';

            // Loop through all categories (including new ones)
            const cats = ['expr', 'outfit', 'obj', 'bg', 'txt', 'light', 'angle', 'fx'];

            cats.forEach((cat, i) => {
                const inputEl = document.getElementById(`inp-${cat}`);
                if (inputEl.value === "") {
                    inputEl.placeholder = d.placeholders[i];
                }
                // HUD labels logic
                if (document.getElementById(`hl-${cat}`)) {
                    document.getElementById(`hl-${cat}`).innerText = d.hudLabels[i + 1];
                }

                // Render Chips
                const container = document.getElementById(`list-${cat}`);
                const countSpan = document.getElementById(`count-${cat}`);
                if (!container) return;

                container.innerHTML = '';

                const listData = dataPool[currentLang][cat];
                const valuesData = dataPool['en'][cat];

                if (countSpan) countSpan.innerText = listData.length;

                listData.forEach((item, index) => {
                    const chip = document.createElement('div');
                    chip.className = 'chip';

                    const iconSpan = document.createElement('span');
                    iconSpan.className = 'chip-icon';
                    iconSpan.innerText = item.i;

                    const labelText = document.createTextNode(item.l);

                    chip.appendChild(iconSpan);
                    chip.appendChild(labelText);

                    // Value to Set: EN description for Prompt, Localized for Text
                    let valueToSet = valuesData[index].l;
                    if (cat === 'txt') valueToSet = item.l;

                    chip.onclick = () => {
                        const input = document.getElementById(`inp-${cat}`);
                        input.value = valueToSet;

                        // Visual feedback
                        input.style.borderColor = 'var(--accent)';
                        input.style.boxShadow = '0 0 15px rgba(56, 189, 248, 0.4)';
                        setTimeout(() => {
                            input.style.borderColor = 'var(--glass-border)';
                            input.style.boxShadow = 'none';
                        }, 300);
                        updateHud();
                    };
                    container.appendChild(chip);
                });
            });
        }

        function toggleLang() {
            currentLang = currentLang === 'tr' ? 'en' : 'tr';
            renderUI();
            setMode(currentMode);
            updateHud();
        }

        function setMode(mode) {
            currentMode = mode;
            const d = dataPool[currentLang];

            document.getElementById('btn-ref').className = mode === 'ref' ? 'mode-btn active' : 'mode-btn';
            document.getElementById('btn-rnd').className = mode === 'rnd' ? 'mode-btn active' : 'mode-btn';
            document.getElementById('mode-desc').innerText = mode === 'ref' ? d.modeDescRef : d.modeDescRnd;
            updateHud();
        }

        function setAr(ar) {
            currentAr = ar;
            document.getElementById('ar-169').className = ar === '16:9' ? 'ar-btn active' : 'ar-btn';
            document.getElementById('ar-916').className = ar === '9:16' ? 'ar-btn active' : 'ar-btn';
            drawPreview();
        }

        function setPos(pos) {
            currentPos = pos;
            document.getElementById('pos-left').className = pos === 'left' ? 'pos-btn active' : 'pos-btn';
            document.getElementById('pos-center').className = pos === 'center' ? 'pos-btn active' : 'pos-btn';
            document.getElementById('pos-right').className = pos === 'right' ? 'pos-btn active' : 'pos-btn';
            updateHud();
            drawPreview();
        }

        function setGender(gender) {
            currentGender = gender;
            document.getElementById('gender-male').className = gender === 'male' ? 'gender-btn active' : 'gender-btn';
            document.getElementById('gender-female').className = gender === 'female' ? 'gender-btn active' : 'gender-btn';
            document.getElementById('gender-char').className = gender === 'character' ? 'gender-btn active' : 'gender-btn';
            updateHud();
            drawPreview();
        }

        function setTxtPos(pos) {
            currentTxtPos = pos;
            ['left', 'top', 'auto', 'bottom', 'right'].forEach(p => {
                document.getElementById(`txtpos-${p}`).className = pos === p ? 'txt-pos-btn active' : 'txt-pos-btn';
            });
            updateHud();
            drawPreview();
        }

        function applyPreset(presetName) {
            const preset = presets[presetName];
            if (!preset) return;

            // Save current state for undo
            saveUndoState();

            // Apply preset values
            document.getElementById('inp-expr').value = preset.expr || '';
            document.getElementById('inp-outfit').value = preset.outfit || '';
            document.getElementById('inp-obj').value = preset.obj || '';
            document.getElementById('inp-bg').value = preset.bg || '';
            document.getElementById('inp-txt').value = preset.txt || '';
            document.getElementById('inp-light').value = preset.light || '';
            document.getElementById('inp-angle').value = preset.angle || '';
            document.getElementById('inp-fx').value = preset.fx || '';

            updateHud();
            drawPreview();
            showToast(currentLang === 'tr' ? `${presetName.toUpperCase()} ≈üablonu uygulandƒ±!` : `${presetName.toUpperCase()} preset applied!`);
        }

        function toggleFavorite() {
            const currentSettings = getCurrentSettings();
            const hash = JSON.stringify(currentSettings);

            if (isFavorite) {
                favorites = favorites.filter(f => JSON.stringify(f) !== hash);
                isFavorite = false;
                document.getElementById('fav-btn').classList.remove('saved');
            } else {
                favorites.push(currentSettings);
                isFavorite = true;
                document.getElementById('fav-btn').classList.add('saved');
            }

            localStorage.setItem('thumbStudioFavorites', JSON.stringify(favorites));
            showToast(isFavorite ? (currentLang === 'tr' ? 'Favorilere eklendi!' : 'Added to favorites!') : (currentLang === 'tr' ? 'Favorilerden √ßƒ±karƒ±ldƒ±!' : 'Removed from favorites!'));
        }

        function getCurrentSettings() {
            return {
                mode: currentMode,
                ar: currentAr,
                pos: currentPos,
                gender: currentGender,
                txtPos: currentTxtPos,
                expr: document.getElementById('inp-expr').value,
                outfit: document.getElementById('inp-outfit').value,
                obj: document.getElementById('inp-obj').value,
                bg: document.getElementById('inp-bg').value,
                txt: document.getElementById('inp-txt').value,
                light: document.getElementById('inp-light').value,
                angle: document.getElementById('inp-angle').value,
                fx: document.getElementById('inp-fx').value
            };
        }

        function applySettings(settings) {
            if (settings.mode) setMode(settings.mode);
            if (settings.ar) setAr(settings.ar);
            if (settings.pos) setPos(settings.pos);
            if (settings.gender) setGender(settings.gender);
            if (settings.txtPos) setTxtPos(settings.txtPos);

            document.getElementById('inp-expr').value = settings.expr || '';
            document.getElementById('inp-outfit').value = settings.outfit || '';
            document.getElementById('inp-obj').value = settings.obj || '';
            document.getElementById('inp-bg').value = settings.bg || '';
            document.getElementById('inp-txt').value = settings.txt || '';
            document.getElementById('inp-light').value = settings.light || '';
            document.getElementById('inp-angle').value = settings.angle || '';
            document.getElementById('inp-fx').value = settings.fx || '';

            updateHud();
            drawPreview();
        }

        function loadFavorites() {
            const saved = localStorage.getItem('thumbStudioFavorites');
            if (saved) {
                favorites = JSON.parse(saved);
            }
        }

        function exportSettings() {
            const settings = getCurrentSettings();
            settings.favorites = favorites;
            settings.history = promptHistory;

            const blob = new Blob([JSON.stringify(settings, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'thumbnail-studio-settings.json';
            a.click();
            URL.revokeObjectURL(url);

            showToast(currentLang === 'tr' ? 'Ayarlar dƒ±≈üa aktarƒ±ldƒ±!' : 'Settings exported!');
        }

        function importSettings() {
            document.getElementById('import-file').click();
        }

        function handleImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const settings = JSON.parse(e.target.result);
                    applySettings(settings);
                    if (settings.favorites) {
                        favorites = settings.favorites;
                        localStorage.setItem('thumbStudioFavorites', JSON.stringify(favorites));
                    }
                    if (settings.history) {
                        promptHistory = settings.history;
                        localStorage.setItem('thumbStudioHistory', JSON.stringify(promptHistory));
                        renderHistory();
                    }
                    showToast(currentLang === 'tr' ? 'Ayarlar i√ße aktarƒ±ldƒ±!' : 'Settings imported!');
                } catch (err) {
                    showToast(currentLang === 'tr' ? 'Hatalƒ± dosya formatƒ±!' : 'Invalid file format!');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function saveUndoState() {
            const state = getCurrentSettings();
            undoStack.push(state);
            if (undoStack.length > 20) undoStack.shift();
        }

        function undo() {
            if (undoStack.length === 0) return;
            const state = undoStack.pop();
            applySettings(state);
            showToast(currentLang === 'tr' ? 'Geri alƒ±ndƒ±!' : 'Undone!');
        }

        function showToast(message) {
            const existing = document.querySelector('.toast');
            if (existing) existing.remove();

            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerText = message;
            document.body.appendChild(toast);

            setTimeout(() => toast.remove(), 2500);
        }

        function updatePromptStats(text) {
            const chars = text.length;
            const words = text.trim().split(/\s+/).filter(w => w).length;
            const tokens = Math.ceil(chars / 4); // Rough approximation

            document.getElementById('stat-chars').innerText = chars;
            document.getElementById('stat-words').innerText = words;
            document.getElementById('stat-tokens').innerText = tokens;
            document.getElementById('prompt-stats').style.display = text ? 'flex' : 'none';
        }

        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                // Ctrl+Enter = Generate
                if (e.ctrlKey && e.key === 'Enter') {
                    e.preventDefault();
                    generate();
                }
                // Ctrl+Z = Undo
                if (e.ctrlKey && e.key === 'z' && !e.shiftKey) {
                    e.preventDefault();
                    undo();
                }
            });
        }

        function resetAll() {
            if (!confirm(currentLang === 'tr' ? 'T√ºm ayarlar sƒ±fƒ±rlansƒ±n mƒ±?' : 'Reset all settings?')) return;

            saveUndoState();

            const fields = ['expr', 'outfit', 'obj', 'bg', 'txt', 'light', 'angle', 'fx'];
            fields.forEach(f => {
                const el = document.getElementById(`inp-${f}`);
                if (el) el.value = '';
            });
            document.getElementById('output').value = '';
            setMode('ref');
            setPos('right');
            setGender('male');
            setTxtPos('auto');
            updateHud();
            drawPreview();
            document.getElementById('prompt-stats').style.display = 'none';
        }

        function updateHud() {
            const d = dataPool[currentLang];

            // Mode
            const modeText = currentMode === 'ref' ? (currentLang === 'tr' ? 'FOTO_REF' : 'PHOTO_REF') : (currentLang === 'tr' ? 'RASTGELE' : 'RANDOM');
            const modeEl = document.getElementById('hv-mode');
            modeEl.innerText = modeText;
            modeEl.style.color = currentMode === 'ref' ? '#eab308' : '#f43f5e';

            // Position
            const posEl = document.getElementById('hv-pos');
            const posLabelEl = document.getElementById('hl-pos');
            if (posEl) {
                posEl.innerText = d.posLabels[currentPos].toUpperCase();
            }
            if (posLabelEl) {
                posLabelEl.innerText = d.posHudLabel;
            }
            // Update position button labels
            document.getElementById('txt-pos-left').innerText = d.posLabels.left;
            document.getElementById('txt-pos-center').innerText = d.posLabels.center;
            document.getElementById('txt-pos-right').innerText = d.posLabels.right;

            // Inputs
            const fields = ['expr', 'outfit', 'obj', 'bg', 'txt', 'light'];
            fields.forEach(f => {
                const val = document.getElementById(`inp-${f}`).value;
                const displayVal = val ? (val.length > 18 ? val.substring(0, 16) + ".." : val) : "N/A";
                const el = document.getElementById(`hv-${f}`);
                if (el) {
                    el.innerText = displayVal;
                    if (f !== 'txt') el.style.color = val ? 'white' : 'var(--text-muted)';
                }
            });
        }

        function drawPreview() {
            const canvas = document.getElementById('preview-canvas');
            const ctx = canvas.getContext('2d');
            const d = dataPool[currentLang];

            // Set canvas size based on aspect ratio
            if (currentAr === '16:9') {
                canvas.width = 640;
                canvas.height = 360;
            } else {
                canvas.width = 360;
                canvas.height = 640;
            }

            const w = canvas.width;
            const h = canvas.height;

            // Clear canvas with gradient background
            const bgGrad = ctx.createLinearGradient(0, 0, w, h);
            bgGrad.addColorStop(0, '#1a1a2e');
            bgGrad.addColorStop(1, '#16213e');
            ctx.fillStyle = bgGrad;
            ctx.fillRect(0, 0, w, h);

            // Add subtle grid pattern
            ctx.strokeStyle = 'rgba(255,255,255,0.03)';
            ctx.lineWidth = 1;
            for (let i = 0; i < w; i += 40) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, h);
                ctx.stroke();
            }
            for (let j = 0; j < h; j += 40) {
                ctx.beginPath();
                ctx.moveTo(0, j);
                ctx.lineTo(w, j);
                ctx.stroke();
            }

            // Character dimensions
            const charWidth = currentAr === '16:9' ? w * 0.35 : w * 0.6;
            const charHeight = currentAr === '16:9' ? h * 0.75 : h * 0.4;

            // Text area dimensions
            const txtWidth = currentAr === '16:9' ? w * 0.35 : w * 0.7;
            const txtHeight = currentAr === '16:9' ? h * 0.3 : h * 0.15;

            let charX, charY, txtX, txtY;

            // Calculate character position
            charY = currentAr === '16:9' ? h - charHeight - 10 : (h - charHeight) / 2;

            if (currentPos === 'left') {
                charX = w * 0.05;
            } else if (currentPos === 'center') {
                charX = (w - charWidth) / 2;
            } else { // right
                charX = w - charWidth - w * 0.05;
            }

            // Calculate text position based on currentTxtPos
            if (currentTxtPos === 'auto') {
                // Auto: opposite to character
                if (currentPos === 'left') {
                    txtX = w * 0.55;
                    txtY = h * 0.35;
                } else if (currentPos === 'center') {
                    txtX = (w - txtWidth) / 2;
                    txtY = currentAr === '16:9' ? h * 0.08 : h * 0.05;
                } else {
                    txtX = w * 0.08;
                    txtY = h * 0.35;
                }
            } else if (currentTxtPos === 'left') {
                txtX = w * 0.05;
                txtY = h * 0.35;
            } else if (currentTxtPos === 'right') {
                txtX = w - txtWidth - w * 0.05;
                txtY = h * 0.35;
            } else if (currentTxtPos === 'top') {
                txtX = (w - txtWidth) / 2;
                txtY = h * 0.05;
            } else if (currentTxtPos === 'bottom') {
                txtX = (w - txtWidth) / 2;
                txtY = h - txtHeight - h * 0.05;
            }

            // Draw character silhouette with glow
            ctx.shadowColor = '#8b5cf6';
            ctx.shadowBlur = 20;

            const charGrad = ctx.createLinearGradient(charX, charY, charX, charY + charHeight);
            charGrad.addColorStop(0, '#a78bfa');
            charGrad.addColorStop(1, '#7c3aed');
            ctx.fillStyle = charGrad;

            // Draw character shape (rounded rectangle with head)
            const headRadius = charWidth * 0.25;
            const bodyTop = charY + headRadius * 2 + 10;

            // Head
            ctx.beginPath();
            ctx.arc(charX + charWidth / 2, charY + headRadius, headRadius, 0, Math.PI * 2);
            ctx.fill();

            // Body
            roundRect(ctx, charX + charWidth * 0.15, bodyTop, charWidth * 0.7, charHeight - headRadius * 2 - 20, 15);
            ctx.fill();

            // Reset shadow
            ctx.shadowBlur = 0;

            // Draw character label
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 14px Inter';
            ctx.textAlign = 'center';
            const charLabel = currentLang === 'tr' ? 'KARAKTER' : 'CHARACTER';
            ctx.fillText(charLabel, charX + charWidth / 2, charY + charHeight + 25);

            // Draw text area with glow
            ctx.shadowColor = '#38bdf8';
            ctx.shadowBlur = 15;

            const txtGrad = ctx.createLinearGradient(txtX, txtY, txtX + txtWidth, txtY + txtHeight);
            txtGrad.addColorStop(0, '#0ea5e9');
            txtGrad.addColorStop(1, '#38bdf8');
            ctx.fillStyle = txtGrad;

            roundRect(ctx, txtX, txtY, txtWidth, txtHeight, 10);
            ctx.fill();

            // Reset shadow
            ctx.shadowBlur = 0;

            // Text label inside
            const overlayText = document.getElementById('inp-txt').value || (currentLang === 'tr' ? 'YAZI' : 'TEXT');
            ctx.fillStyle = '#fff';
            ctx.font = 'bold ' + (txtHeight * 0.4) + 'px Inter';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(overlayText.substring(0, 12), txtX + txtWidth / 2, txtY + txtHeight / 2);

            // Draw aspect ratio indicator
            ctx.fillStyle = 'rgba(255,255,255,0.5)';
            ctx.font = '12px JetBrains Mono';
            ctx.textAlign = 'right';
            ctx.textBaseline = 'top';
            ctx.fillText(currentAr, w - 10, 10);

            // Store element bounds for drag detection
            updateElementBounds(charX, charY, charWidth, charHeight, txtX, txtY, txtWidth, txtHeight);

            // Update legend texts
            document.getElementById('legend-char').innerText = currentLang === 'tr' ? 'Karakter' : 'Character';
            document.getElementById('legend-text').innerText = currentLang === 'tr' ? 'Yazƒ±' : 'Text';
            document.getElementById('legend-bg').innerText = currentLang === 'tr' ? 'Arka Plan' : 'Background';
            document.getElementById('txt-preview-title').innerText = currentLang === 'tr' ? '√ñNƒ∞ZLEME // LAYOUT PREVIEW' : 'PREVIEW // LAYOUT PREVIEW';
        }

        // Helper function for rounded rectangles
        function roundRect(ctx, x, y, width, height, radius) {
            ctx.beginPath();
            ctx.moveTo(x + radius, y);
            ctx.lineTo(x + width - radius, y);
            ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
            ctx.lineTo(x + width, y + height - radius);
            ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
            ctx.lineTo(x + radius, y + height);
            ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
            ctx.lineTo(x, y + radius);
            ctx.quadraticCurveTo(x, y, x + radius, y);
            ctx.closePath();
        }

        // =============================
        // *** CANVAS DRAG & DROP ***
        // =============================
        let isDragging = false;
        let dragTarget = null; // 'char' or 'text'
        let dragStartX = 0;
        let dragStartY = 0;

        // Store element bounds for hit detection
        let charBounds = { x: 0, y: 0, w: 0, h: 0 };
        let textBounds = { x: 0, y: 0, w: 0, h: 0 };

        function setupCanvasDrag() {
            const canvas = document.getElementById('preview-canvas');

            canvas.addEventListener('mousedown', handleDragStart);
            canvas.addEventListener('mousemove', handleDragMove);
            canvas.addEventListener('mouseup', handleDragEnd);
            canvas.addEventListener('mouseleave', handleDragEnd);

            // Touch support
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                handleDragStart({ clientX: touch.clientX, clientY: touch.clientY, target: canvas });
            });
            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                handleDragMove({ clientX: touch.clientX, clientY: touch.clientY, target: canvas });
            });
            canvas.addEventListener('touchend', handleDragEnd);
        }

        function getCanvasCoords(e) {
            const canvas = document.getElementById('preview-canvas');
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            return {
                x: (e.clientX - rect.left) * scaleX,
                y: (e.clientY - rect.top) * scaleY
            };
        }

        function handleDragStart(e) {
            const coords = getCanvasCoords(e);

            // Check if clicking on character
            if (isPointInBounds(coords.x, coords.y, charBounds)) {
                isDragging = true;
                dragTarget = 'char';
                dragStartX = coords.x;
            }
            // Check if clicking on text
            else if (isPointInBounds(coords.x, coords.y, textBounds)) {
                isDragging = true;
                dragTarget = 'text';
                dragStartX = coords.x;
            }

            if (isDragging) {
                document.getElementById('preview-canvas').style.cursor = 'grabbing';
            }
        }

        function handleDragMove(e) {
            if (!isDragging) {
                // Change cursor based on hover
                const coords = getCanvasCoords(e);
                const canvas = document.getElementById('preview-canvas');
                if (isPointInBounds(coords.x, coords.y, charBounds) || isPointInBounds(coords.x, coords.y, textBounds)) {
                    canvas.style.cursor = 'grab';
                } else {
                    canvas.style.cursor = 'default';
                }
                return;
            }

            const coords = getCanvasCoords(e);
            const canvas = document.getElementById('preview-canvas');
            const w = canvas.width;

            // Determine position based on x coordinate
            let newPos;
            if (coords.x < w / 3) {
                newPos = 'left';
            } else if (coords.x < w * 2 / 3) {
                newPos = 'center';
            } else {
                newPos = 'right';
            }

            // Update the appropriate position
            if (dragTarget === 'char' && newPos !== currentPos) {
                setPos(newPos);
            } else if (dragTarget === 'text') {
                // For text, map horizontal position
                if (newPos === 'left' && currentTxtPos !== 'left') {
                    setTxtPos('left');
                } else if (newPos === 'center' && currentTxtPos !== 'top') {
                    setTxtPos('top');
                } else if (newPos === 'right' && currentTxtPos !== 'right') {
                    setTxtPos('right');
                }
            }
        }

        function handleDragEnd() {
            if (isDragging) {
                isDragging = false;
                dragTarget = null;
                document.getElementById('preview-canvas').style.cursor = 'grab';
                showToast(currentLang === 'tr' ? 'Pozisyon g√ºncellendi!' : 'Position updated!');
            }
        }

        function isPointInBounds(x, y, bounds) {
            return x >= bounds.x && x <= bounds.x + bounds.w &&
                y >= bounds.y && y <= bounds.y + bounds.h;
        }

        // Update drawPreview to store bounds
        function updateElementBounds(cX, cY, cW, cH, tX, tY, tW, tH) {
            charBounds = { x: cX, y: cY, w: cW, h: cH };
            textBounds = { x: tX, y: tY, w: tW, h: tH };
        }

        function generate() {
            // Basic
            const expr = document.getElementById('inp-expr').value || "excited expression";
            const outfit = document.getElementById('inp-outfit').value || "casual clothes";
            const obj = document.getElementById('inp-obj').value || "looking at camera";
            const bg = document.getElementById('inp-bg').value || "cinematic background";
            const txt = document.getElementById('inp-txt').value || "VIDEO";

            // Advanced
            const light = document.getElementById('inp-light').value || "dramatic cinematic lighting";
            const angle = document.getElementById('inp-angle').value || "eye-level shot";
            const fx = document.getElementById('inp-fx').value || "sharp focus";

            // Gender-based subject
            let subject = "";
            let pronoun = "They are";
            if (currentMode === 'rnd') {
                if (currentGender === 'male') {
                    subject = "a charismatic young male content creator";
                    pronoun = "He is";
                } else if (currentGender === 'female') {
                    subject = "an attractive young female content creator";
                    pronoun = "She is";
                } else {
                    subject = "a futuristic android/robot character";
                    pronoun = "It is";
                }
            } else {
                if (currentGender === 'male') {
                    subject = "the male content creator";
                    pronoun = "He is";
                } else if (currentGender === 'female') {
                    subject = "the female content creator";
                    pronoun = "She is";
                } else {
                    subject = "the character";
                    pronoun = "They are";
                }
            }

            // Dynamic position text
            let positionText = "";
            let textPosition = "";

            // Character position
            if (currentPos === 'left') {
                positionText = "Positioned on the left side of the frame";
            } else if (currentPos === 'center') {
                positionText = "Positioned in the center of the frame";
            } else {
                positionText = "Positioned on the right side of the frame (rule of thirds)";
            }

            // Text position (auto or manual)
            if (currentTxtPos === 'auto') {
                if (currentPos === 'left') {
                    textPosition = "On the right side";
                } else if (currentPos === 'center') {
                    textPosition = "At the top";
                } else {
                    textPosition = "On the left side";
                }
            } else if (currentTxtPos === 'left') {
                textPosition = "On the left side";
            } else if (currentTxtPos === 'right') {
                textPosition = "On the right side";
            } else if (currentTxtPos === 'top') {
                textPosition = "At the top";
            } else if (currentTxtPos === 'bottom') {
                textPosition = "At the bottom";
            }

            const prompt = `A hyper-realistic, high-ctr YouTube thumbnail featuring ${subject} with an expression of ${expr}, making direct eye contact. ${pronoun} wearing ${outfit}. ${positionText}. In the foreground/hands, interacting with ${obj}. The background is a ${bg}. The scene is illuminated by ${light}. Camera angle is ${angle}. Visual effects: ${fx}. ${textPosition}, large, bold, 3D typography with a glossy metallic texture and sharp white outline reads "${txt}". Shot with Sony A7S III, f/1.8 aperture, highly detailed, photorealistic, 8k, ray tracing, global illumination, --ar ${currentAr} --v 6.0`;

            const output = document.getElementById('output');
            output.value = prompt;
            output.scrollIntoView({ behavior: "smooth", block: "center" });

            addToHistory(prompt);
            updatePromptStats(prompt);
        }

        function copyResult() {
            const txt = document.getElementById('output');
            if (!txt.value) return;
            txt.select();
            txt.setSelectionRange(0, 99999);
            navigator.clipboard.writeText(txt.value);

            const btn = document.querySelector('.copy-btn');
            const oldHTML = btn.innerHTML;
            btn.innerHTML = "<i>‚úÖ</i> KOPYALANDI!";
            btn.style.background = "#22c55e";
            btn.style.borderColor = "#22c55e";
            setTimeout(() => {
                btn.innerHTML = oldHTML;
                btn.style.background = "rgba(51, 65, 85, 0.8)";
                btn.style.borderColor = "var(--glass-border)";
            }, 2000);
        }

        // --- HISTORY FUNCTIONS ---
        function loadHistory() {
            const stored = localStorage.getItem('ts_history');
            if (stored) {
                promptHistory = JSON.parse(stored);
                renderHistory();
            }
        }

        function addToHistory(prompt) {
            // Add to beginning
            promptHistory.unshift(prompt);
            // Keep max 20 items
            if (promptHistory.length > 20) promptHistory.pop();

            localStorage.setItem('ts_history', JSON.stringify(promptHistory));
            renderHistory();
        }

        function deleteHistory(index) {
            promptHistory.splice(index, 1);
            localStorage.setItem('ts_history', JSON.stringify(promptHistory));
            renderHistory();
        }

        function clearHistory() {
            if (confirm(currentLang === 'tr' ? 'T√ºm ge√ßmi≈ü silinsin mi?' : 'Clear all history?')) {
                promptHistory = [];
                localStorage.setItem('ts_history', JSON.stringify(promptHistory));
                renderHistory();
            }
        }

        function renderHistory() {
            const list = document.getElementById('history-list');
            list.innerHTML = '';

            promptHistory.forEach((item, index) => {
                const el = document.createElement('div');
                el.className = 'history-item';

                const txtDiv = document.createElement('div');
                txtDiv.className = 'hist-text';
                txtDiv.innerText = item;

                const actionDiv = document.createElement('div');
                actionDiv.className = 'hist-actions';

                const btnCopy = document.createElement('button');
                btnCopy.className = 'h-btn';
                btnCopy.innerText = 'COPY';
                btnCopy.onclick = () => {
                    navigator.clipboard.writeText(item);
                    btnCopy.innerText = 'OK';
                    setTimeout(() => btnCopy.innerText = 'COPY', 1000);
                };

                const btnDel = document.createElement('button');
                btnDel.className = 'h-btn h-del';
                btnDel.innerText = 'X';
                btnDel.onclick = () => deleteHistory(index);

                actionDiv.appendChild(btnCopy);
                actionDiv.appendChild(btnDel);

                el.appendChild(txtDiv);
                el.appendChild(actionDiv);
                list.appendChild(el);
            });
        }

        // Start the engine
        init();

    </script>

</body>

</html>